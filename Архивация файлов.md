
### **Ключевые команды**

- **`tar`** — универсальный инструмент для работы с архивами.
- **`gzip` / `gunzip`** — утилиты для сжатия и распаковки отдельных файлов.

```bash
tar [ФЛАГИ] -f [ИМЯ_АРХИВА] [ЧТО_УПАКОВАТЬ_ИЛИ_КУДА_РАСПАКОВАТЬ]
```

### **Флаги tar (Мантра: `-czvf` и `-xzvf`)**

- `-c` (**Create**): Создать архив.
- `-x` (**Extract**): Распаковать архив.
- `-z` (**Gzip**): Использовать сжатие gzip (самое популярное, расширение `.tar.gz`).
- `-j` (bzip2) — использовать более сильное сжатие `.bz2`.
- `-v` (**Verbose**): Выводить имена файлов в процессе (подробный режим).
- `-t` (**List**): Показать содержимое (без распаковки).
- `-f` (**File**): Указать имя файла архива. **Всегда ставь этот флаг последним** в блоке опций!
- `-C` (directory) — распаковать в указанную папку.


### Примеры использования

#### **Упаковка (Backup)**

Создать сжатый архив `backup.tar.gz` из папки `logs`:

```bash
tar -czvf backupt.tar.gz logs/
```
#### **Распаковка (Restore)**

Распаковать архив в _текущую_ папку:

```bash
tar -xzvf backup.tar.gz
```

Распаковать архив в _конкретную_ папку `/tmp/restore`:

```bash
mkdir -p /tmp/restore
tar -xzvf backup.tar.gz -C /tmp/restore
```
#### **Просмотр (Inspection)**

Посмотреть, что внутри, не распаковывая (защита от мусора):

```bash
tar -tvf backup.tar.gz
```

### Популярные пайплайны

**A. Бэкап и передача на другой сервер (без создания файла на диске):** Экономит место и время. Мы пакуем файлы в поток (stdout) и сразу отправляем по SSH.

```bash
tar -czf - ./app_data | ssh user@backup_server "cat > /backups/app_data.tar.gz"
```

**B. Архивация только определенных файлов (с `find`):** Найти все логи старше 7 дней и упаковать их:

```bash
find /var/log -name "*.log" -mtime +7 -print0 | xargz -0 tar -czvf old_logs.tar.gz
```

**C. Исключение лишнего:** Упаковать проект, но игнорировать папку `.git` и временные файлы:

```bash
tar -czvf project.tar.gz --exclude='.git' --exclue='*.tmp' ./my_project
```

### Best Practices

- **Всегда проверяй содержимое (`-t`)**: Всегда делай `tar -tf archive.tar.gz`, чтобы убедиться, что файлы не рассыплются по всей текущей папке (так называемая "tar-бомба").
- **Относительные пути**: Старайся архивировать, находясь _над_ папкой, или используй относительные пути (`./folder`). 
  Если заархивировать файл как `/etc/nginx/nginx.conf` (абсолютный путь), при распаковке `tar` может попытаться перезаписать системный файл. 
  Современный `tar` обычно убирает начальный слэш `/` для безопасности, но лучше не рисковать.
- **Порядок флагов**: Запомни мантру `czvf` и `xzvf`. Флаг `-f` **обязан** быть последним, потому что сразу за ним ожидается имя файла.
    - ✅ `tar -czvf archive.tar.gz .`
    - ❌ `tar -cvfz archive.tar.gz .` (Ошибка: `tar` подумает, что архив называется `z`).
    
- **Pipe + Tar:** Можно передавать данные в tar через пайп. Например, для бэкапа базы данных: `mysqldump db | gzip > backup.sql.gz`.
